# Reflex Pipelines Documentation

Эта документация описывает все основные пайплайны (потоки обработки) в фреймворке Reflex.

**Важно**: Reflex не является AI-агентом. Это фреймворк для создания веб-приложений. Документация описывает пайплайны обработки данных и генерации кода в рамках работы фреймворка.

## Содержание

1. [Пайплайн Инициализации Приложения](#пайплайн-инициализации-приложения)
2. [Пайплайн Компиляции](#пайплайн-компиляции)
3. [Пайплайн Обработки Событий](#пайплайн-обработки-событий)
4. [Пайплайн Рендеринга Компонентов](#пайплайн-рендеринга-компонентов)

---

## Пайплайн Инициализации Приложения

### Описание

Пайплайн инициализации запускается при выполнении команды `reflex init` и создает новое Reflex приложение с базовой структурой файлов и конфигурацией.

### Точка входа

`reflex/utils/templates.py:initialize_app()`

### Схема процесса

```
┌─────────────────────────────────────────┐
│  Пользователь запускает: reflex init    │
└──────────────────┬──────────────────────┘
                   │
                   v
┌─────────────────────────────────────────┐
│  initialize_app(app_name, template)     │
│  reflex/utils/templates.py:362          │
└──────────────────┬──────────────────────┘
                   │
                   v
         ┌────────┴────────┐
         │  Проверка:      │
         │  Существует ли  │
         │  rxconfig.py?   │
         └────────┬────────┘
                  │
         ┌────────┴────────┐
         │                 │
         v                 v
     ┌─────┐           ┌─────┐
     │ Да  │           │ Нет │
     └──┬──┘           └──┬──┘
        │                 │
        v                 v
   ┌─────────┐      ┌──────────────────────┐
   │ reinit  │      │ Запрос выбора        │
   │ teleme- │      │ шаблона (если не     │
   │ try     │      │ указан)              │
   └─────────┘      └──────────┬───────────┘
                               │
                               v
                    ┌──────────────────────┐
                    │ prompt_for_template_ │
                    │ options()            │
                    │ Промт пользователю   │
                    └──────────┬───────────┘
                               │
                               v
                    ┌──────────────────────┐
                    │ get_init_cli_prompt_ │
                    │ options()            │
                    │ Варианты:            │
                    │ 0. AI Builder        │
                    │ 1. Blank App         │
                    │ 2. Choose Templates  │
                    └──────────┬───────────┘
                               │
                               v
                    ┌──────────────────────┐
                    │ Выбор пользователя   │
                    └──────────┬───────────┘
                               │
            ┌──────────────────┼──────────────────┐
            │                  │                  │
            v                  v                  v
    ┌─────────────┐    ┌─────────────┐   ┌─────────────┐
    │ AI Builder  │    │ Blank App   │   │ Templates   │
    │ Redirect    │    │             │   │ (remote)    │
    └─────────────┘    └──────┬──────┘   └──────┬──────┘
                              │                  │
                              v                  v
                ┌──────────────────────┐  ┌──────────────────────┐
                │ initialize_default_  │  │ fetch_remote_        │
                │ app(app_name)        │  │ templates()          │
                └──────────┬───────────┘  └──────────┬───────────┘
                           │                         │
                           v                         v
                ┌──────────────────────┐  ┌──────────────────────┐
                │ create_config()      │  │ validate_and_create_ │
                │ Генерация:           │  │ app_using_remote_    │
                │ rxconfig.py          │  │ template()           │
                │                      │  │                      │
                │ Использует:          │  │ Загрузка ZIP файла   │
                │ rxconfig_template()  │  │ с GitHub             │
                └──────────┬───────────┘  └──────────┬───────────┘
                           │                         │
                           v                         v
                ┌──────────────────────┐  ┌──────────────────────┐
                │ initialize_app_      │  │ create_config_init_  │
                │ directory()          │  │ app_from_remote_     │
                │                      │  │ template()           │
                │ Копирование файлов   │  │                      │
                │ шаблона, переимено-  │  │ Распаковка ZIP,      │
                │ вание директорий и   │  │ копирование файлов,  │
                │ обновление импортов  │  │ переименование       │
                └──────────┬───────────┘  └──────────┬───────────┘
                           │                         │
                           └────────┬────────────────┘
                                    │
                                    v
                         ┌──────────────────────┐
                         │ Готовое приложение   │
                         │                      │
                         │ Структура:           │
                         │ - rxconfig.py        │
                         │ - app_name/          │
                         │   - app_name.py      │
                         │ - assets/            │
                         │ - requirements.txt   │
                         └──────────────────────┘
```

### Используемые промты и шаблоны

1. **CLI Промты**:
   - `ask()` - для получения ответов пользователя
   - `prompt_for_template_options()` - выбор типа шаблона
   - `get_init_cli_prompt_options()` - варианты шаблонов

2. **Шаблоны кода**:
   - `rxconfig_template(app_name)` - генерация конфигурационного файла

### Передаваемые данные между этапами

```
initialize_app
    ├─> app_name (str): имя приложения
    └─> template (str | None): выбранный шаблон
        │
        ├─> prompt_for_template_options
        │       └─> returns: template_name (str)
        │
        ├─> create_config
        │       ├─> input: app_name
        │       └─> generates: rxconfig.py file
        │
        └─> initialize_app_directory
                ├─> input: app_name, template_name, template_dir
                └─> generates: полная структура приложения
```

### Примеры выполнения

#### Пример 1: Создание пустого приложения

```bash
$ reflex init my_app --template blank
```

**Поток данных**:
1. `app_name = "my_app"`
2. `template = "blank"` (указан явно, промт пропускается)
3. Вызов `initialize_default_app("my_app")`
4. `create_config("my_app")` → генерация rxconfig.py
5. `initialize_app_directory("my_app")` → копирование шаблона
6. Результат: директория `my_app/` с базовым приложением

#### Пример 2: Интерактивный выбор шаблона

```bash
$ reflex init my_app
```

**Поток данных**:
1. `app_name = "my_app"`
2. `template = None` (не указан)
3. Вызов `prompt_for_template_options(get_init_cli_prompt_options())`
4. Промт пользователю:
   ```
   Get started with a template:
   (0) Try our free AI builder.
   (1) A blank Reflex app.
   (2) Premade templates built by the Reflex team.
   Which template would you like to use? [0]:
   ```
5. Пользователь выбирает: `1`
6. `template = "blank"`
7. Далее как в примере 1

---
